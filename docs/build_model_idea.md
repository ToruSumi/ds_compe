# 機械学習モデル構築時に検討すべきこと

## 学習データとテストデータの分割

学習データとテストデータの分割方法には、以下のようなものがある。

- ランダムサンプリング
- 時系列データの場合は、時系列に沿った分割を行う
- クラスタリングを行い、クラスタごとに分割を行う
- グループKFold

## クロスバリデーション

クロスバリデーション（CV）は、モデルの汎化性能を評価するために用いられる手法である。データセットを複数のグループに分割し、そのうちの一つをテストデータ、残りを訓練データとして学習を行い、テストデータで評価する。これを複数回繰り返し、その平均値を評価指標とする。

以下検討するべき内容をまとめる。

- early_stoppingを使う場合も、各モデルごとにepoch数が異なるため、CVを使うことで、epoch数を調整することができる
- 時系列の場合は、時系列に沿ったCVを行うことで、未来のデータに対しても適切な評価を行うことができる

## アンサンブル

複数のモデルを組み合わせることで、単一のモデルよりも高い精度を実現することができる。アンサンブル学習の代表的な手法には、バギング、ブースティング、スタッキングなどがある。

それぞれのモデルでは違う観点で予測を行なうこと。

- データセットをランダムに分割して、それぞれのモデルに学習させる
  - CVのseedを変える
- モデルの種類を変える
- ハイパーパラメータを変える
- 特徴量を変える

## ハイパーパラメータチューニング

モデルによって様々なパラメーターがあり、そのパラメーターを最適化することで、モデルの精度を向上させることができる。以下にチューニングする価値がありそうなパラメーターを示す。

- LightGBM
  - learning_rate
  - num_leaves
  - feature_fraction_bynode
  - min_data_in_leaf

使用できるライブラリとしては以下のようなものがある

- Optuna
- keras-tuner
- hyperopt


## ID毎の結果の平均

ID毎に複数の予測結果がある場合、その平均を取ることで、より安定した予測結果を得ることができる。
